(this["webpackJsonpreact-mesto-api-full-frontend"]=this["webpackJsonpreact-mesto-api-full-frontend"]||[]).push([[0],{29:function(e,t,n){},36:function(e,t,n){"use strict";n.r(t);var a=n(1),c=n.n(a),o=n(20),s=n.n(o),i=n(9),r=(n(29),n(24)),u=n(2),l=n.p+"static/media/header__logo.c2821b38.svg",p=n(0);var d=function(e){var t=e.email,n=e.loggedIn,a=e.onSignOut,o=c.a.useState(!1),s=Object(u.a)(o,2),i=s[0],r=s[1];return c.a.useEffect((function(){r(!1)}),[n]),Object(p.jsxs)("header",{className:"header",children:[Object(p.jsx)("img",{className:"header__logo",src:l,alt:"\u041c\u0435\u0441\u0442\u043e"}),Object(p.jsxs)("div",{className:"header__container ".concat(!n||i?"header__container_visible":""," ").concat(i?"header__container_open":""),children:[Object(p.jsx)("p",{className:"header__mail ".concat(n&&i?"header__mail_visible":""),children:"\u0412\u043e\u0439\u0442\u0438"!==t&&"\u0420\u0435\u0433\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u044f"!==t?t:""}),Object(p.jsx)("button",{className:"header__button ".concat(i?"header__button_open":""),onClick:a,children:"\u0412\u043e\u0439\u0442\u0438"===t||"\u0420\u0435\u0433\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u044f"===t?t:"\u0412\u044b\u0439\u0442\u0438"})]}),Object(p.jsx)("button",{className:"header__mobile-button ".concat(n?"header__mobile-button_visible":""," ").concat(i?"header__mobile-button_open":""),onClick:function(){r(!i)}})]})},j=n(14),h=n(13),b=c.a.createContext();var m=function(e){var t=e.link,n=e.cardId,a=e.handleCardClick,o=e.onCardLike,s=e.onCardDelete,i=e.owner,r=e.name,u=e.likes,l=c.a.useContext(b),d=u.some((function(e){return e===l._id}));return Object(p.jsxs)("div",{className:"card",children:[Object(p.jsx)("img",{className:"card__image",src:t,alt:r,onClick:function(){a({name:r,link:t})}}),l._id===i?Object(p.jsx)("button",{type:"button",className:"card__trash-button",onClick:function(){s({cardId:n})}}):Object(p.jsx)(p.Fragment,{}),Object(p.jsx)("p",{className:"card__text",children:r}),Object(p.jsx)("button",{type:"button",className:d?"card__like-button card__like-button_active":"card__like-button",id:"like",onClick:function(){o({cardId:n,likes:u})}}),Object(p.jsx)("p",{className:"card__like-counter",children:u.length})]})};var _=function(e){var t=e.onEditProfile,n=e.onAddPlace,a=e.onEditAvatar,o=e.onCardClick,s=e.cards,i=e.onCardLike,r=e.onCardDelete,u=c.a.useContext(b);return Object(p.jsxs)("main",{className:"main",children:[Object(p.jsxs)("section",{className:"profile",children:[Object(p.jsxs)("div",{className:"profile__avatar",children:[Object(p.jsx)("img",{className:"profile__img",src:u.avatar,alt:"\u0412\u0430\u0448 \u0430\u0432\u0430\u0442\u0430\u0440"}),Object(p.jsx)("div",{className:"profile__overlay",onClick:a})]}),Object(p.jsxs)("div",{className:"profile__info",children:[Object(p.jsx)("p",{className:"profile__author",children:u.name}),Object(p.jsx)("button",{type:"button",className:"profile__edit-button",onClick:t}),Object(p.jsx)("p",{className:"profile__subject",children:u.about})]}),Object(p.jsx)("button",{type:"button",className:"profile__add-button",onClick:n})]}),Object(p.jsx)("section",{className:"cards",children:s.map((function(e){var t=e._id,n=Object(h.a)(e,["_id"]);return Object(p.jsx)(m,Object(j.a)({onCardLike:i,onCardDelete:r,handleCardClick:o,cardId:t},n),t)}))})]})};var f=function(){return Object(p.jsx)("footer",{className:"footer",children:Object(p.jsx)("p",{className:"footer__text",children:"\xa9 2020 Mesto Russia"})})},O=n(21),x=n(22),v=new(function(){function e(t){Object(O.a)(this,e),this.url=t.baseUrl}return Object(x.a)(e,[{key:"_handleResponse",value:function(e){return e.ok?e.json():Promise.reject(e.statusText)}},{key:"getUser",value:function(e){return fetch("".concat(this.url,"/users/me"),{method:"GET",headers:{"Content-Type":"application/json",authorization:"Bearer ".concat(e)}}).then(this._handleResponse)}},{key:"getInitialCards",value:function(e){return fetch("".concat(this.url,"/cards"),{method:"GET",headers:{"Content-Type":"application/json",authorization:"Bearer ".concat(e)}}).then(this._handleResponse)}},{key:"updateProfileInfo",value:function(e,t){return fetch("".concat(this.url,"/users/me"),{method:"PATCH",headers:{"Content-Type":"application/json",authorization:"Bearer ".concat(t)},body:JSON.stringify({name:e.name,about:e.object})}).then(this._handleResponse)}},{key:"updateProfileAvatar",value:function(e,t){return fetch("".concat(this.url,"/users/me/avatar"),{method:"PATCH",headers:{"Content-Type":"application/json",authorization:"Bearer ".concat(t)},body:JSON.stringify({avatar:e.avatar})}).then(this._handleResponse)}},{key:"createCard",value:function(e,t){return fetch("".concat(this.url,"/cards"),{method:"POST",headers:{"Content-Type":"application/json",authorization:"Bearer ".concat(t)},body:JSON.stringify({name:e.name,link:e.object})}).then(this._handleResponse)}},{key:"deleteCard",value:function(e,t){return fetch("".concat(this.url,"/cards/").concat(e),{method:"DELETE",headers:{"Content-Type":"application/json",authorization:"Bearer ".concat(t)}}).then(this._handleResponse)}},{key:"changeLikeCardStatus",value:function(e,t,n){return t?fetch("".concat(this.url,"/cards/likes/").concat(e),{method:"PUT",headers:{"Content-Type":"application/json",authorization:"Bearer ".concat(n)}}).then(this._handleResponse):fetch("".concat(this.url,"/cards/likes/").concat(e),{method:"DELETE",headers:{"Content-Type":"application/json",authorization:"Bearer ".concat(n)}}).then(this._handleResponse)}},{key:"registerUser",value:function(e){return fetch("".concat(this.url,"/signup"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e.email,password:e.password})}).then(this._handleResponse)}},{key:"loginUser",value:function(e){return fetch("".concat(this.url,"/signin"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({password:e.password,email:e.email})}).then(this._handleResponse)}}]),e}())({baseUrl:"https://api.maxsin.students.nomoreparties.co"});var g=function(e){var t=e.onClose,n=e.card;return Object(p.jsx)("div",{className:n?"popup popup_opened":"popup",id:"photo",children:Object(p.jsxs)("div",{className:"popup__photo-container",children:[Object(p.jsx)("button",{type:"button",className:"popup__close-button",onClick:t}),Object(p.jsx)("img",{className:"popup__photo-image",src:n?n.link:"",alt:n?n.name:""}),Object(p.jsx)("p",{className:"popup__photo-text",children:n?n.name:""})]})})};var C=function(e){var t=e.title,n=e.name,a=e.submitButtonText,c=e.isOpen,o=e.onClose,s=e.children,i=e.onSubmit;return Object(p.jsx)("div",{className:c?"popup popup_opened":"popup",id:n,children:Object(p.jsxs)("form",{className:"popup__container",onSubmit:i,children:[Object(p.jsx)("button",{type:"button",className:"popup__close-button",onClick:o}),Object(p.jsx)("h2",{className:"popup__title",children:t}),s,Object(p.jsx)("button",{type:"submit",className:"popup__submit-button",children:a})]})})};var N=function(e){var t=e.isOpen,n=e.onClose,a=e.onUpdateUser,o=c.a.useState(""),s=Object(u.a)(o,2),i=s[0],r=s[1],l=c.a.useState(""),d=Object(u.a)(l,2),j=d[0],h=d[1],m=c.a.useContext(b);return c.a.useEffect((function(){r(m.name),h(m.about)}),[m]),Object(p.jsxs)(C,{title:"\u0420\u0435\u0434\u0430\u043a\u0442\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u043f\u0440\u043e\u0444\u0438\u043b\u044c",name:"editPopup",submitButtonText:"\u0421\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u044c",isOpen:t,onClose:n,onSubmit:function(e){e.preventDefault(),a({name:i,object:j})},children:[Object(p.jsx)("input",{type:"text",value:i||"",onChange:function(e){r(e.target.value)},className:"popup__input",id:"name",minLength:"2",maxLength:"40",placeholder:"\u0418\u043c\u044f",required:!0,name:"name"}),Object(p.jsx)("span",{className:"popup__text-error",id:"name-error"}),Object(p.jsx)("input",{type:"text",value:j||"",onChange:function(e){h(e.target.value)},className:"popup__input",id:"subject",placeholder:"\u041e \u0441\u0435\u0431\u0435",minLength:"2",maxLength:"200",required:!0,name:"object"}),Object(p.jsx)("span",{className:"popup__text-error",id:"subject-error"})]})};var k=function(e){var t=e.isOpen,n=e.onClose,a=e.onUpdateAvatar,o=c.a.useRef();return Object(p.jsx)(C,{title:"\u041e\u0431\u043d\u043e\u0432\u0438\u0442\u044c \u0430\u0432\u0430\u0442\u0430\u0440",name:"avatarPopup",submitButtonText:"\u0421\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u044c",isOpen:t,onClose:n,onSubmit:function(e){e.preventDefault(),a({avatar:o.current.value})},children:Object(p.jsx)("input",{type:"url",className:"popup__input popup__input_type_avatar",id:"source",placeholder:"\u0421\u0441\u044b\u043b\u043a\u0430 \u043d\u0430 \u0430\u0432\u0430\u0442\u0430\u0440\u043a\u0443",required:!0,name:"object",ref:o})})};var y=function(e){var t=e.isOpen,n=e.onClose,a=e.onAddPlace,o=c.a.useRef(),s=c.a.useRef();return Object(p.jsxs)(C,{title:"\u041d\u043e\u0432\u043e\u0435 \u043c\u0435\u0441\u0442\u043e",name:"addPopup",submitButtonText:"\u0421\u043e\u0437\u0434\u0430\u0442\u044c",isOpen:t,onClose:n,onSubmit:function(e){e.preventDefault(),a({name:o.current.value,object:s.current.value}),o.current.value="",s.current.value=""},children:[Object(p.jsx)("input",{type:"text",className:"popup__input",id:"place",placeholder:"\u041d\u0430\u0437\u0432\u0430\u043d\u0438\u0435",minLength:"1",maxLength:"30",required:!0,name:"name",ref:o}),Object(p.jsx)("span",{className:"popup__text-error",id:"place-error"}),Object(p.jsx)("input",{type:"url",className:"popup__input",id:"source",placeholder:"\u0421\u0441\u044b\u043b\u043a\u0430 \u043d\u0430 \u043a\u0430\u0440\u0442\u0438\u043d\u043a\u0443",required:!0,name:"object",ref:s}),Object(p.jsx)("span",{className:"popup__text-error",id:"source-error"})]})},S=n(3);var I=function(e){var t=e.onSetEmail,n=e.onLogin;c.a.useEffect((function(){t({email:"\u0420\u0435\u0433\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u044f"})}),[]);var a=c.a.useState(""),o=Object(u.a)(a,2),s=o[0],r=o[1],l=c.a.useState(""),d=Object(u.a)(l,2),j=d[0],h=d[1];return Object(p.jsx)("div",{className:"auth",children:Object(p.jsxs)("form",{className:"auth__container",onSubmit:function(e){e.preventDefault(),s&&j&&(n({password:j,email:s}),r(""),h(""))},children:[Object(p.jsx)("h2",{className:"auth__title",children:"\u0412\u0445\u043e\u0434"}),Object(p.jsx)("input",{type:"email",value:s,className:"auth__input",placeholder:"Email",required:!0,onChange:function(e){r(e.target.value)}}),Object(p.jsx)("input",{type:"password",value:j,className:"auth__input",placeholder:"\u041f\u0430\u0440\u043e\u043b\u044c",required:!0,onChange:function(e){h(e.target.value)}}),Object(p.jsx)("button",{type:"submit",className:"auth__submit-button",children:"\u0412\u043e\u0439\u0442\u0438"}),Object(p.jsx)(i.b,{to:"/signup",className:"auth__redirect",children:"\u0415\u0449\u0451 \u043d\u0435 \u0437\u0430\u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0438\u0440\u043e\u0432\u0430\u043d\u044b? \u0420\u0435\u0433\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u044f"})]})})};var T=function(e){var t=e.onSetEmail,n=e.onRegister;c.a.useEffect((function(){t({email:"\u0412\u043e\u0439\u0442\u0438"})}),[]);var a=c.a.useState(""),o=Object(u.a)(a,2),s=o[0],r=o[1],l=c.a.useState(""),d=Object(u.a)(l,2),j=d[0],h=d[1];return Object(p.jsx)("div",{className:"auth",children:Object(p.jsxs)("form",{className:"auth__container",onSubmit:function(e){e.preventDefault(),n({password:j,email:s})},children:[Object(p.jsx)("h2",{className:"auth__title",children:"\u0420\u0435\u0433\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u044f"}),Object(p.jsx)("input",{type:"email",value:s,className:"auth__input",placeholder:"Email",required:!0,onChange:function(e){r(e.target.value)}}),Object(p.jsx)("input",{type:"password",value:j,className:"auth__input",placeholder:"\u041f\u0430\u0440\u043e\u043b\u044c",required:!0,onChange:function(e){h(e.target.value)}}),Object(p.jsx)("button",{type:"submit",className:"auth__submit-button",children:"\u0417\u0430\u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0438\u0440\u043e\u0432\u0430\u0442\u044c\u0441\u044f"}),Object(p.jsx)(i.b,{to:"/signin",className:"auth__redirect",children:"\u0423\u0436\u0435 \u0437\u0430\u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0438\u0440\u043e\u0432\u0430\u043d\u044b? \u0412\u043e\u0439\u0442\u0438"})]})})},E=function(e){var t=e.component,n=Object(h.a)(e,["component"]);return Object(p.jsx)(S.b,{children:function(){return n.loggedIn?Object(p.jsx)(t,Object(j.a)({},n)):Object(p.jsx)(S.a,{to:"./signin"})}})},P=n.p+"static/media/popup__successful-register.a9eb6caf.svg",R=n.p+"static/media/popup__err-register.d4ce2a26.svg";var L=function(e){var t=e.isOpen,n=e.success,a=e.successText,c=e.onClose;return Object(p.jsx)("div",{className:t?"popup popup_opened":"popup",children:Object(p.jsxs)("div",{className:"popup__container popup__container_register",children:[Object(p.jsx)("button",{type:"button",className:"popup__close-button popup__close-button_register",onClick:c}),Object(p.jsx)("img",{className:"popup__image",src:n?P:R,alt:n?"\u0433\u0430\u043b\u043e\u0447\u043a\u0430 \u0432 \u043a\u0440\u0443\u0436\u043a\u0435":"\u043a\u0440\u0435\u0441\u0442\u0438\u043a \u0432 \u043a\u0440\u0443\u0436\u043a\u0435"}),Object(p.jsx)("h2",{className:"popup__title popup__title_register",children:a})]})})};var U=Object(S.h)((function(){c.a.useEffect((function(){le()}),[]);var e=Object(S.g)(),t=c.a.useState(!1),n=Object(u.a)(t,2),a=n[0],o=n[1],s=c.a.useState(!1),i=Object(u.a)(s,2),l=i[0],j=i[1],h=c.a.useState(!1),m=Object(u.a)(h,2),O=m[0],x=m[1],C=c.a.useState(!1),P=Object(u.a)(C,2),R=P[0],U=P[1],B=c.a.useState(!1),w=Object(u.a)(B,2),A=w[0],D=w[1],q=c.a.useState(""),z=Object(u.a)(q,2),J=z[0],G=z[1],H=c.a.useState(),M=Object(u.a)(H,2),F=M[0],K=M[1],Q=c.a.useState(""),V=Object(u.a)(Q,2),W=V[0],X=V[1],Y=c.a.useState([]),Z=Object(u.a)(Y,2),$=Z[0],ee=Z[1],te=c.a.useState(!1),ne=Object(u.a)(te,2),ae=ne[0],ce=ne[1],oe=c.a.useState(""),se=Object(u.a)(oe,2),ie=se[0],re=se[1];function ue(e){re(e.email)}function le(){if(localStorage.getItem("token")){var t=localStorage.getItem("token");v.getUser(t).then((function(t){!function(e){ce(!0),ue(e),X(e);var t=localStorage.getItem("token");v.getInitialCards(t).then((function(e){ee(e.reverse())})).catch((function(e){console.log("\u041e\u0448\u0438\u0431\u043a\u0430 \u0437\u0430\u043f\u0440\u043e\u0441\u0430 \u043a\u0430\u0440\u0442\u043e\u0447\u0435\u043a: ".concat(e))}))}(t),e.push("/")})).catch((function(e){return console.log("\u041e\u0448\u0438\u0431\u043a\u0430 \u043f\u0440\u043e\u0432\u0435\u0440\u043a\u0438 \u0442\u043e\u043a\u0435\u043d\u0430")}))}}var pe=function(){o(!1),x(!1),j(!1),U(!1),K()};return Object(p.jsx)(b.Provider,{value:W,children:Object(p.jsxs)("div",{className:"page",children:[Object(p.jsx)(d,{email:ie,loggedIn:ae,onSignOut:function(){"\u0420\u0435\u0433\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u044f"===ie?e.push("/signup"):("\u0412\u043e\u0439\u0442\u0438"!==ie&&(localStorage.removeItem("token"),ce(!1)),e.push("/signin"))}}),Object(p.jsxs)(S.d,{children:[Object(p.jsx)(S.b,{path:"/signin",children:Object(p.jsx)(I,{onSetEmail:ue,onLogin:function(e){v.loginUser(e).then((function(e){localStorage.setItem("token",e.token),le()})).catch((function(e){console.log("\u041e\u0448\u0438\u0431\u043a\u0430 \u0432\u0445\u043e\u0434\u0430: ".concat(e)),G("\u0427\u0442\u043e-\u0442\u043e \u043f\u043e\u0448\u043b\u043e \u043d\u0435 \u0442\u0430\u043a! \u041f\u043e\u043f\u0440\u043e\u0431\u0443\u0439\u0442\u0435 \u0435\u0449\u0435 \u0440\u0430\u0437."),U(!0),D(!1)}))}})}),Object(p.jsx)(S.b,{path:"/signup",children:Object(p.jsx)(T,{onSetEmail:ue,onRegister:function(t){v.registerUser(t).then((function(t){e.push("/signin"),G("\u0412\u044b \u0443\u0441\u043f\u0435\u0448\u043d\u043e \u0437\u0430\u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0438\u0440\u043e\u0432\u0430\u043b\u0438\u0441\u044c!"),U(!0),D(!0)})).catch((function(e){G("\u0427\u0442\u043e-\u0442\u043e \u043f\u043e\u0448\u043b\u043e \u043d\u0435 \u0442\u0430\u043a! \u041f\u043e\u043f\u0440\u043e\u0431\u0443\u0439\u0442\u0435 \u0435\u0449\u0435 \u0440\u0430\u0437."),U(!0),D(!1)}))}})}),Object(p.jsx)(E,{path:"/",loggedIn:ae,component:_,onEditProfile:function(){o(!0)},onAddPlace:function(){j(!0)},onEditAvatar:function(){x(!0)},onCardClick:function(e){K(e)},cards:$,onCardLike:function(e){var t=e.likes.some((function(e){return e===W._id})),n=localStorage.getItem("token");v.changeLikeCardStatus(e.cardId,!t,n).then((function(t){var n=$.map((function(n){return n._id===e.cardId?t:n}));ee(n)})).catch((function(e){console.log("\u041e\u0448\u0438\u0431\u043a\u0430 \u043b\u0430\u0439\u043a\u0430: ".concat(e))}))},onCardDelete:function(e){var t=localStorage.getItem("token");v.deleteCard(e.cardId,t).then((function(){var t=$.filter((function(t){return!(t._id===e.cardId)}));ee(t)})).catch((function(e){console.log("\u041e\u0448\u0438\u0431\u043a\u0430 \u0443\u0434\u0430\u043b\u0435\u043d\u0438\u044f \u043a\u0430\u0440\u0442\u043e\u0447\u043a\u0438: ".concat(e))}))}}),Object(p.jsx)(S.b,{children:ae?Object(p.jsx)(S.a,{to:"/"}):Object(p.jsx)(S.a,{to:"/signin"})})]}),Object(p.jsx)(f,{}),Object(p.jsx)(N,{isOpen:a,onClose:pe,onUpdateUser:function(e){var t=localStorage.getItem("token");v.updateProfileInfo(e,t).then((function(e){X(e),pe()})).catch((function(e){console.log("\u041e\u0448\u0438\u0431\u043a\u0430 \u043e\u0431\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u044f \u043f\u0440\u043e\u0444\u0438\u043b\u044f: ".concat(e))}))}}),Object(p.jsx)(y,{isOpen:l,onClose:pe,onAddPlace:function(e){var t=localStorage.getItem("token");v.createCard(e,t).then((function(e){ee([e].concat(Object(r.a)($))),pe()})).catch((function(e){console.log("\u041e\u0448\u0438\u0431\u043a\u0430 \u0441\u043e\u0437\u0434\u0430\u043d\u0438\u044f \u043a\u0430\u0440\u0442\u043e\u0447\u043a\u0438: ".concat(e))}))}}),Object(p.jsx)(k,{isOpen:O,onClose:pe,onUpdateAvatar:function(e){var t=localStorage.getItem("token");v.updateProfileAvatar(e,t).then((function(e){X(e),pe()})).catch((function(e){console.log("\u041e\u0448\u0438\u0431\u043a\u0430 \u043e\u0431\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u044f \u0430\u0432\u0430\u0442\u0430\u0440\u0430: ".concat(e))}))}}),Object(p.jsx)(g,{onClose:pe,card:F}),Object(p.jsx)(L,{isOpen:R,success:A,onClose:pe,successText:J})]})})}));s.a.render(Object(p.jsx)(c.a.StrictMode,{children:Object(p.jsx)(i.a,{children:Object(p.jsx)(U,{})})}),document.getElementById("root"))}},[[36,1,2]]]);
//# sourceMappingURL=main.0b9cb282.chunk.js.map